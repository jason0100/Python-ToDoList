{% extends "layout.html" %}

{% block css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.2/css/all.css">
<style>
    .fa-trash {
        color:red;
  cursor:pointer;
    float:right;
}

</style>

{% endblock %}


{% block content %}

<h2>{{ title }}.</h2>
<button class="btn btn-primary" data-toggle="modal" data-target="#myModal">Add List</button>

<!-- The Modal -->
<div class="modal fade" id="myModal">
    <div class="modal-dialog">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Add New To Do List</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <div class="form-group">
                    <label class="control-label">List Name</label>
                    <input class="form-control" type="text" name="listName" id="listName" />
                    <sapn class="errorMsg text-danger" id="errorMsg"></sapn>
                </div>
            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
                <button class="btn btn-success" onclick="addNewLists('#listName')">Save</button>
                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            </div>

        </div>
    </div>
</div>

{% if todolists %}
<table class="table table-hover">
    <tbody>
        {% for t in todolists %}
        <tr>
            <td>
                <div>
                    <input value={{t.key}} /> 
                    <a href="/todoitems/?key={{t.key}}">{{t.text}}</a> 
                    <i class="fa fa-trash"></i>
                </div>

            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>No ToDoList available.</p>
<br />
<form action="/seed" method="post">
    <button class="btn btn-primary" type="submit">Create Sample ToDoList</button>
</form>

{% endif %}


{% endblock %}
 {% block scripts %}
<script>
    //alert('test')
    function addNewLists(element) {
        //alert($(element).val())
        //$.post('/addList', { 'name': $(element).val() }).done(function (data) {
        //    console.log(JSON.stringify(data))
        //    data = JSON.parse(data);
        //    if (data[0] == 'success')
        //        location.reload();
        //    else {
        //        $('#errorMsg').text(data[1]);

        //    }

        //})

        const uri = "/todolist"
        const list = {
            name: $(element).val()
        };


        fetch(uri, {
            method: 'POST',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(list)
        })
            .then(res => {
                return res.json();
            })
            .then(result => {
                //console.log(result[0]);
                if (result[0] == 'success') {
                    location.reload();
                }
                else {
                    $('#errorMsg').text(result[1]);
                }
            });

    }


   
    $('.fa-trash').click(function () {
        if (confirm('Are you sure to delete this?')) { 
            console.log('delete key id = ' + $(this).siblings('input').val());

            const uri = "/todolist";
            fetch(uri+'/'+$(this).siblings('input').val(), {
                method: 'DELETE',
        
            }).then(res => {
                    return res.json();
                })
            .then(result => {
          
                if (result[0] == 'success') {
                    location.reload();
                }
                else {
  
                    alert(result[1]);
                }
            });
        }


    
    })
    
</script>
{% endblock %}